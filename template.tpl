___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "displayName": "Contentsquare - Artificial Pageview",
  "description": "Trigger Artificial Page-views",
  "categories": [
    "ANALYTICS",
    "HEAT_MAP",
    "SESSION_RECORDING"
  ],
  "securityGroups": [],
  "id": "cvt_temp_public_id",
  "type": "TAG",
  "version": 1.9,
  "brand": {
    "thumbnail": "data:image/png;base64,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",
    "displayName": "contentsquare-ps",
    "id": "github.com_contentsquare-ps"
  },
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "artificial_pageview_value",
    "displayName": "Artificial Pageview Value",
    "simpleValueType": true,
    "help": "Add the text you want to send in the query string. The text must be a maximum of 255 characters. Do not add “#”, since all that comes after will be erased. Please note that the domain will be automatically added before, and the query after.\n\nLeave blank if you choose the closing popup option."
  },
  {
    "type": "SELECT",
    "name": "options",
    "displayName": "Choose option",
    "macrosInSelect": false,
    "selectItems": [
      {
        "value": "free",
        "displayValue": "Free text"
      },
      {
        "value": "popup",
        "displayValue": "Use for the opening of a popup"
      },
      {
        "value": "close-popup",
        "displayValue": "Use for the closing of a popup"
      }
    ],
    "simpleValueType": true,
    "help": "Pick an option for the format of the artificial pageview. Default is free text. \n\nIf you choose the option for the opening of a popup then the value will be prefixed with cs-popin- in the query string. \n\nIf you choose the option for the closing of a popup then the value will be empty and a default artificial pageview will be sent with no special text in the query string. Do not insert a value in the open field."
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

//const logToConsole = require('logToConsole');
const getUrl = require('getUrl');
const parseUrl = require('parseUrl');
const urlObject = parseUrl(getUrl());
const createQueue = require('createQueue');

let _uxaPush = createQueue('_uxa');
const pathname = urlObject.pathname;
const search = urlObject.search;
const hash = urlObject.hash;
const options = data.options;

let apv_val = data.artificial_pageview_value;
if (!apv_val) {
    apv_val = "";
}

let popup_state = "";

if (options === "popup") {
    popup_state = "cs-popin-";
} else if (options === "close-popup") {
    apv_val = "";
}

if (options != "close-popup") {
    if (apv_val || popup_state) {
        _uxaPush(["setQuery", search + (search ? "&" : "?") + popup_state + apv_val]);
    }

    _uxaPush(["trackPageview", pathname + hash.replace("#", "?__")]);
    _uxaPush(["setQuery", search]);
} else {
    _uxaPush(["setQuery", search]);
    _uxaPush(["trackPageview", pathname + hash.replace("#", "?__")]);
}

data.gtmOnSuccess();


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "_uxa"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_url",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urlParts",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "queriesAllowed",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Developed by Uri Gobey @ Contentsquare

